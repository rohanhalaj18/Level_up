<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coding Round â€“ AI Checked</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root[data-theme="dark"] {
            --bg-primary: #0a0a0a;
            --bg-secondary: #0f0f0f;
            --bg-tertiary: #141414;
            --bg-card: #1a1a1a;
            --border-color: #2d2d2d;
            --text-primary: #e5e5e5;
            --text-secondary: #b4b4b4;
            --accent-primary: #667eea;
            --accent-secondary: #764ba2;
            --code-color: #9ef;
        }

        :root[data-theme="light"] {
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafb;
            --bg-tertiary: #f1f5f9;
            --bg-card: #ffffff;
            --border-color: rgba(16, 185, 129, 0.2);
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --accent-primary: #10b981;
            --accent-secondary: #34d399;
            --code-color: #0891b2;
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            height: 100vh;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .header {
            background: var(--bg-card);
            padding: 12px 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            font-size: 22px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }

        .theme-toggle {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-primary);
            font-weight: 600;
        }

        .theme-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .company-tag {
            background: rgba(var(--accent-primary-rgb), 0.1);
            border: 1px solid var(--border-color);
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 13px;
            color: var(--accent-primary);
            font-weight: 600;
        }

        .container {
            display: flex;
            height: calc(100vh - 60px);
        }

        .left-panel {
            width: 45%;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            padding: 24px;
        }

        .right-panel {
            width: 55%;
            display: flex;
            flex-direction: column;
            background: var(--bg-tertiary);
        }

        .question-title {
            font-size: 24px;
            margin-bottom: 16px;
            color: var(--text-primary);
            font-weight: 600;
        }

        .difficulty {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .difficulty.easy {
            background: rgba(0, 184, 163, 0.1);
            color: #00b8a3;
        }

        .difficulty.medium {
            background: rgba(255, 192, 30, 0.1);
            color: #ffc01e;
        }

        .description {
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: 24px;
            font-size: 14px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            margin: 24px 0 12px;
            color: var(--text-primary);
        }

        .test-case {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 14px;
            margin-bottom: 12px;
            font-family: 'Consolas', monospace;
            font-size: 13px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .test-case-label {
            color: var(--text-secondary);
            font-size: 11px;
            text-transform: uppercase;
            margin-bottom: 6px;
        }

        .test-case-value {
            color: var(--code-color);
            background: var(--bg-secondary);
            padding: 8px;
            border-radius: 4px;
            margin-top: 4px;
        }

        .code-editor-header {
            background: var(--bg-card);
            padding: 12px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .language-selector {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
        }

        .code-editor {
            flex: 1;
            background: var(--bg-secondary);
            position: relative;
        }

        textarea {
            width: 100%;
            height: 100%;
            background: transparent;
            border: none;
            color: var(--code-color);
            padding: 20px;
            font-size: 14px;
            font-family: 'Consolas', 'Monaco', monospace;
            resize: none;
            line-height: 1.6;
            outline: none;
        }

        .action-bar {
            background: var(--bg-card);
            padding: 16px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .btn {
            padding: 10px 24px;
            border-radius: 8px;
            border: none;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Consolas', monospace;
        }

        .btn-run {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-run:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .btn-submit {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: #fff;
            position: relative;
            overflow: hidden;
        }

        .btn-submit::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% {
                left: -50%;
            }

            100% {
                left: 150%;
            }
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
        }

        .btn-submit:active {
            transform: translateY(0);
        }

        #result {
            background: var(--bg-secondary);
            border-left: 3px solid var(--accent-primary);
            padding: 16px;
            margin: 20px;
            border-radius: 8px;
            white-space: pre-wrap;
            font-size: 13px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }

        #result.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .status-success {
            color: #00b8a3;
        }

        .status-error {
            color: #ff5555;
        }

        /* Custom Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.show {
            display: flex;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .modal {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlide 0.4s ease;
            border: 2px solid var(--border-color);
        }

        @keyframes modalSlide {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-icon {
            font-size: 4em;
            text-align: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 15px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .modal-message {
            color: var(--text-secondary);
            text-align: center;
            line-height: 1.6;
            margin-bottom: 25px;
            font-size: 14px;
        }

        .modal-quote {
            background: var(--bg-secondary);
            border-left: 3px solid var(--accent-primary);
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 8px;
            font-style: italic;
            color: var(--text-secondary);
        }

        .modal-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 25px;
        }

        .modal-btn {
            padding: 12px 30px;
            border-radius: 10px;
            border: none;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn-primary {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
        }

        .modal-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
        }

        .modal-btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .modal-btn-secondary:hover {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
    </style>
</head>

<body>
    <div class="header">
        <div class="header-left">
            <div class="logo">CodeJudge</div>
            <button class="theme-toggle" id="themeToggle">ðŸŒ™ Dark Mode</button>
        </div>
        <div class="company-tag" id="companyTag">Loading...</div>
    </div>

    <div class="container">
        <div class="left-panel">
            <div id="questionContent">
                <h1 class="question-title">Loading Question...</h1>
            </div>
        </div>

        <div class="right-panel">
            <div class="code-editor-header">
                <select class="language-selector">
                    <option>JavaScript</option>
                </select>
            </div>

            <div class="code-editor">
                <textarea id="code" spellcheck="false">function solve(input) {
  // Write your solution here
  
}</textarea>
            </div>

            <div id="result"></div>

            <div class="action-bar">
                <button class="btn btn-run" id="runBtn">â–¶ Run Code</button>
                <button class="btn btn-submit" id="submitBtn">
                    <span>Submit Solution</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Custom Modal -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-icon" id="modalIcon">ðŸŽ‰</div>
            <h2 class="modal-title" id="modalTitle">Success!</h2>
            <p class="modal-message" id="modalMessage">Great job!</p>
            <div class="modal-quote" id="modalQuote"></div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-primary" id="modalPrimaryBtn">Continue</button>
                <button class="modal-btn modal-btn-secondary" id="modalSecondaryBtn" style="display: none;">Try
                    Again</button>
            </div>
        </div>
    </div>

    <script>
        const base = "http://localhost:5000";
        const company = sessionStorage.getItem("selectedCompany") || "TCS";
        const sessionId = sessionStorage.getItem("sessionId");

        document.getElementById("companyTag").innerText = company;

        // Theme Toggle
        const themeToggle = document.getElementById("themeToggle");
        const root = document.documentElement;
        let currentTheme = localStorage.getItem("theme") || "dark";

        function setTheme(theme) {
            root.setAttribute("data-theme", theme);
            themeToggle.textContent = theme === "dark" ? "â˜€ï¸ Light Mode" : "ðŸŒ™ Dark Mode";
            localStorage.setItem("theme", theme);
        }

        setTheme(currentTheme);

        themeToggle.onclick = () => {
            currentTheme = currentTheme === "dark" ? "light" : "dark";
            setTheme(currentTheme);
        };

        const quotes = {
            success: [
                "Success is not final, failure is not fatal: it is the courage to continue that counts.",
                "The only way to do great work is to love what you do.",
                "Code is like humor. When you have to explain it, it's bad.",
                "First, solve the problem. Then, write the code."
            ],
            failure: [
                "Failure is simply the opportunity to begin again, this time more intelligently.",
                "Every expert was once a beginner. Keep learning, keep growing.",
                "It's not about perfect code, it's about better code than yesterday.",
                "Debugging is twice as hard as writing code in the first place."
            ]
        };

        function showModal(type, score, details) {
            const overlay = document.getElementById("modalOverlay");
            const icon = document.getElementById("modalIcon");
            const title = document.getElementById("modalTitle");
            const message = document.getElementById("modalMessage");
            const quote = document.getElementById("modalQuote");
            const primaryBtn = document.getElementById("modalPrimaryBtn");
            const secondaryBtn = document.getElementById("modalSecondaryBtn");

            const randomQuote = type === "success"
                ? quotes.success[Math.floor(Math.random() * quotes.success.length)]
                : quotes.failure[Math.floor(Math.random() * quotes.failure.length)];

            if (type === "success") {
                icon.textContent = "ðŸŽ‰";
                title.textContent = "Congratulations!";
                message.textContent = `You scored ${score}/100 and passed the coding round! You're ready for the next challenge.`;
                primaryBtn.textContent = "Proceed to Interview";
                secondaryBtn.style.display = "none";
                primaryBtn.onclick = () => {
                    window.location.href = "./index.html";
                };
            } else {
                icon.textContent = "ðŸ’ª";
                title.textContent = "Keep Going!";
                message.textContent = `You scored ${score}/100. Don't give up! Every attempt makes you stronger.`;
                primaryBtn.textContent = "Try Again";
                secondaryBtn.style.display = "inline-block";
                secondaryBtn.textContent = "Review Code";
                primaryBtn.onclick = () => {
                    overlay.classList.remove("show");
                };
                secondaryBtn.onclick = () => {
                    overlay.classList.remove("show");
                };
            }

            quote.textContent = randomQuote;
            overlay.classList.add("show");
        }

        const questions = {
            "TCS": {
                title: "Find the Second Largest Number",
                difficulty: "easy",
                description: "Given an array of integers, return the second largest distinct number in the array. If there is no second largest number, return the largest number.",
                testCases: [
                    { input: "[1,5,2,9,7]", output: "7" },
                    { input: "[10,10,9,8]", output: "9" }
                ]
            },
            "Infosys": {
                title: "Count Vowels in String",
                difficulty: "easy",
                description: "Given a string, return the total count of vowels (a, e, i, o, u) in the string. The comparison should be case-insensitive.",
                testCases: [
                    { input: "\"engineer\"", output: "4" },
                    { input: "\"aaaeeeiiiooouu\"", output: "15" }
                ]
            }
        };

        const data = questions[company] || questions["TCS"];

        document.getElementById("questionContent").innerHTML = `
            <h1 class="question-title">${data.title}</h1>
            <span class="difficulty ${data.difficulty}">${data.difficulty.toUpperCase()}</span>
            
            <div class="section-title">Description</div>
            <p class="description">${data.description}</p>
            
            <div class="section-title">Test Cases</div>
            ${data.testCases.map((tc, i) => `
                <div class="test-case">
                    <div class="test-case-label">Example ${i + 1}</div>
                    <div><strong>Input:</strong></div>
                    <div class="test-case-value">${tc.input}</div>
                    <div style="margin-top: 8px;"><strong>Output:</strong></div>
                    <div class="test-case-value">${tc.output}</div>
                </div>
            `).join('')}
        `;

        async function runCode(isSubmit = false) {
            const code = document.getElementById("code").value;
            const resultDiv = document.getElementById("result");
            const submitBtn = document.getElementById("submitBtn");
            const runBtn = document.getElementById("runBtn");

            resultDiv.classList.add("show");
            resultDiv.innerText = isSubmit ? "Submitting to AI Judge..." : "Running test cases...";

            submitBtn.classList.add("loading");
            runBtn.classList.add("loading");

            try {
                const res = await fetch(`${base}/api/placement/check-code`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        code,
                        testCases: data.testCases,
                        sessionId
                    })
                });

                const out = await res.json();

                let resultText = "";
                if (out.score >= 60) {
                    resultText = `âœ“ SUCCESS\n\nScore: ${out.score}/100\n\n${JSON.stringify(out, null, 2)}`;
                    resultDiv.className = "show status-success";

                    if (isSubmit) {
                        setTimeout(() => {
                            showModal("success", out.score, out);
                        }, 800);
                    }
                } else {
                    resultText = `âœ— FAILED\n\nScore: ${out.score}/100\n\n${JSON.stringify(out, null, 2)}`;
                    resultDiv.className = "show status-error";

                    if (isSubmit) {
                        setTimeout(() => {
                            showModal("failure", out.score, out);
                        }, 800);
                    }
                }

                resultDiv.innerText = resultText;
            } catch (error) {
                resultDiv.className = "show status-error";
                resultDiv.innerText = `Error: ${error.message}`;
            } finally {
                submitBtn.classList.remove("loading");
                runBtn.classList.remove("loading");
            }
        }

        document.getElementById("runBtn").onclick = () => runCode(false);
        document.getElementById("submitBtn").onclick = () => runCode(true);

        // Close modal on overlay click
        document.getElementById("modalOverlay").onclick = (e) => {
            if (e.target.id === "modalOverlay") {
                e.target.classList.remove("show");
            }
        };

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                runCode(false);
            }
        });
    </script>
</body>

</html>